<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>百度网盘直链地址获取 | Crexyer's Blog 在线工具</title>
<link href="../css/bootstrap.css" rel="stylesheet">
<link href="../css/bootstrap-theme.css" rel="stylesheet">
<link href="../css/custom.css" rel="stylesheet">
<script src="../js/jquery.js"></script>
<script src="../js/bootstrap.js"></script>
<script src="../js/modernizr.js"></script>
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-43111893-3', 'crexyer.com');
	ga('send', 'pageview');
</script>
</head>
<body>
<script type="text/javascript">
	var baseURL = "http://getfile.duapp.com/";

	function getRequestURL() {
		var originURL = document.getElementById("originURL").value;
		//获取参数
		var file = getFile(originURL);
		var uk = getQueryStringRegExp(originURL, "uk");
		var shareid = getQueryStringRegExp(originURL, "shareid");
		//判断是否为旧版地址格式
		if (file != "") {
			//新版地址格式
			return "file=" + file;
		} else if (uk != "" && shareid != "") {
			//旧版地址格式
			return "uk=" + uk + "&shareid=" + shareid;
		} else {
			//都不正确
			return "";
		}
	}

	function isValidString(szStr) {
		voidChar = "\\\/";
		for (i = 0; i < voidChar.length; i++) {
			aChar = voidChar.substring(i, i + 1);
			if (szStr.indexOf(aChar) > -1) {
				return false;
			}
		}
		return true;
	}

	function getURL() {
		var filename = document.getElementById("filename").value;
		//判断文件名是否合法
		if (isValidString(filename) == false) {
			document.getElementById("title").innerHTML = "提示";
			document.getElementById("info").innerHTML = "文件名中不能含有以下字符：<br>\/ \\";
			$('#dialogue').modal('show');
			$('#dialogue').on('hidden.bs.modal', function() {
				document.getElementById("filename").select();
			});
			return false;
		}
		if (getRequestURL() == "") {
			document.getElementById("title").innerHTML = "提示";
			document.getElementById("info").innerHTML = "请输入正确的地址格式，例如下面的格式：<br>http://pan.baidu.com/s/1n81ky<br>http://pan.baidu.com/share/link?shareid=498673&uk=3145124";
			$('#dialogue').modal('show');
			$('#dialogue').on('hidden.bs.modal', function() {
				document.getElementById("originURL").select();
			});
			return false;
		}
		document.getElementById("progress").className = "progress progress-striped active";
		//是否设置文件名称
		if (filename == "") {
			$.ajax({
				url: baseURL + "info.php?" + getRequestURL(),
				dataType: "jsonp",
				jsonp: "jsonpcallback",
				timeout: 3000,
				success: function(data, status) {
					setNewURL(data[0].filename);
					setFocus();
				},
				error: function(XHR, textStatus, errorThrown) {
					setNewURL("");
					setFocus();
				}
			});
		} else {
			setNewURL(filename);
			setFocus();
		}
	};

	function getFile(URL) {
		var reg = new RegExp("http://pan.baidu.com/s/(.*)", "i");
		if (reg.test(URL)) return URL.match(reg)[1];
		return "";
	};

	function getQueryStringRegExp(URL, name) {
		var reg = new RegExp("(^|\\?|&)" + name + "=([^&]*)(\\s|&|$)", "i");
		if (reg.test(URL)) return unescape(RegExp.$2.replace(/\+/g, " "));
		return "";
	};

	function clearURL() {
		document.getElementById("originURL").value = "";
		document.getElementById("filename").value = "";
		document.getElementById("newURL").value = "";
		document.getElementById("md5").value = "";
	};

	function showTips() {
		document.getElementById("title").innerHTML = "使用说明";
		document.getElementById("info").innerHTML = "输入原始地址后点击按钮即可获取直链，原始地址格式应该和下面的类似：<br>http://pan.baidu.com/s/1n81ky<br>http://pan.baidu.com/share/link?shareid=498673&uk=3145124<br><br>文件名称可以手动填写，它将作为直链地址的一部分，如果不填写的话将自动获取文件的原始名称。<br><br>基于功能的考虑，直链地址只支持单文件外链，即外链地址中只能包含一个文件，不支持多个文件和文件夹。<br><br>直链地址解析服务托管于 BAE，高速稳定，可以保证直链的长期使用。";
		$('#dialogue').modal('show');
	}

	function setFocus() {
		document.getElementById("newURL").select();
		document.getElementById("progress").className = "progress progress-striped active hide";
	}

	function setNewURL(filename) {
		var originURL = document.getElementById("originURL").value;
		//获取参数
		var file = getFile(originURL);
		var uk = getQueryStringRegExp(originURL, "uk");
		var shareid = getQueryStringRegExp(originURL, "shareid");
		if (file != "") {
			//新版地址格式
			document.getElementById("newURL").value = (filename === null || filename == "") ? baseURL + file + "/download" : baseURL + file + "/" + filename;
		} else if (uk != "" && shareid != "") {
			//旧版地址格式
			document.getElementById("newURL").value = (filename === null || filename == "") ? baseURL + uk + "/" + shareid + "/download" : baseURL + uk + "/" + shareid + "/" + filename;
		} else {
			//都不正确
			document.getElementById("newURL").value = "参数错误";
		}
	}
</script>
<nav class="navbar navbar-inverse navbar-fixed-top">
<div class="container">
	<div class="navbar-header">
		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
		<span class="sr-only">下拉导航</span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		</button>
	</div>
	<div class="collapse navbar-collapse navbar-ex1-collapse">
		<ul class="nav navbar-nav">
			<li><a href="http://www.crexyer.com/"><span class="glyphicon glyphicon-home"></span> Crexyer's Blog</a></li>
			<li class="active"><a href="../"><span class="glyphicon glyphicon-wrench"></span> 在线工具</a></li>
			<li><a href="../history.html"><span class="glyphicon glyphicon-time"></span> 更新日志</a></li>
		</ul>
	</div>
</div>
</nav>
<div class="jumbotron">
	<div class="container">
		<h1>百度网盘直链地址获取</h1>
		<p>
			方便地获取百度网盘文件的直链地址，支持各种文件格式，可以作为音乐、图片、视频外链，并且不受流量限制。
		</p>
	</div>
</div>
<div class="container">
	<script>
		if (Modernizr.canvas == false) {
			document.writeln("<div class=\"alert alert-danger fade in\"><button class=\"close\" data-dismiss=\"alert\">×</button><b>警告：</b>您当前的浏览器不支持 HTML5 功能，可能无法正常使用在线工具，建议更换或升级浏览器。</div>");
		}
	</script>
	<div class="form-horizontal" role="form">
		<div class="form-group">
			<label class="col-sm-2 control-label">原始地址</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="originURL" placeholder="http://pan.baidu.com/s/1n81ky">
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">文件名称</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="filename" placeholder="可选，留空将自动获取">
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">直链地址</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="newURL" placeholder="点击按钮获取直链地址">
			</div>
		</div>
		<div class="form-group">
			<div class="col-sm-offset-2 col-sm-10">
				<button class="btn btn-primary" onclick="getURL()">获取直链</button>
				<button class="btn btn-default" onclick="clearURL()">清空数据</button>
				<button class="btn btn-default" onclick="showTips()">使用说明</button>
			</div>
		</div>
		<div id="progress" class="progress progress-striped active hide">
			<div class="progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
			</div>
		</div>
	</div>
	<hr>
	<footer>
	<p>
		&copy; Crexyer &middot; 使用 <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a> 构建 &middot; 更新日期 2013-10-14 &middot; 托管于 <a href="https://github.com/" target="_blank">GitHub</a> &middot; <a href="http://www.crexyer.com/archives/270" target="_blank">意见反馈</a> 
	</p>
	</footer>
</div>
<div id="dialogue" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 id="title" class="modal-title">提示</h4>
			</div>
			<div class="modal-body">
				<p id="info">
				</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
			</div>
		</div>
	</div>
</div>
</body>
</html>